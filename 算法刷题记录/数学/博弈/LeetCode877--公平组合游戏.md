[题目链接](https://leetcode-cn.com/problems/stone-game/)  

[参考链接:OiWiki](https://oi-wiki.org/math/game-theory/impartial-game/)  
部分内容为oiwiki的转载。  

## 一、公平组合游戏综述  
### 1.公平组合游戏的相关概念  
公平组合游戏（Impartial Game）的定义如下：  
1.游戏有两个人参与，二者轮流做出决策，双方均知道游戏的完整信息；  
2.任意一个游戏者在某一确定状态可以作出的决策集合只与当前的状态有关，而与游戏者无关；  
3.游戏中的同一个状态不可能多次抵达，游戏以玩家无法行动为结束，且游戏一定会在有限步后以非平局结束。  
公平组合游戏有取数游戏、Nim游戏等。  
与公平组合游戏相对，非公平组合游戏的游戏者在某一确定状态可以做出的决策集合与游戏者有关。常见的棋类运动，如象棋等都是非公平组合游戏，因为你无法操纵对手的棋子。   

游戏结果和状态的关系可以用状态图表示，例如：  
![](https://oi-wiki.org/math/game-theory/images/game1.png)  
上面的图对应的例子是一类Nim游戏：有n堆物品，每堆有a[i]个，两个玩家轮流取走任意一堆的任意个物品，但不能不取。  
定义 必胜状态 为 先手必胜的状态，必败状态 为 先手必败的状态。  

换种解释就是，当前已经呈现某个特定状态的情况下，先出手的人必胜，则为必胜状态。  
上面那个图可能是不全的。这里暂且认为叶子结点（没有后继的状态）是全0（指在上面的例子中）  

关于必胜状态和必败状态，有如下三条定理：  
定理 1：没有后继状态的状态是必败状态。  
定理 2：一个状态是必胜状态当且仅当存在至少一个必败状态为它的后继状态。  
定理 3：一个状态是必败状态当且仅当它的所有后继状态均为必胜状态。  

对于定理1，如果当前先手方（行动方）无路可走，那么就输了。  
对于定理2，如果一个状态A能通向的状态中存在一个状态B为必败状态，则A状态下的先手方只要令下一个状态为B，则对手必败，所以A是必胜状态。  
对于定理3，如果一个状态A能通向的所有状态都是必胜状态，那么无论A的先手方怎么选择行动，A的对手都能进入必胜状态取胜，所以A是必败状态。  

### 2.SG定理  
先介绍有向无环图游戏。有向图游戏是一个经典的博弈游戏——实际上，大部分的公平组合游戏都可以转换为有向图游戏。  
在一个有向无环图中，只有一个起点，上面有一个棋子，两个玩家轮流沿着有向边推动棋子，不能走的玩家判负。  

要解决这些问题，需要用到Sprague-Grundy定理。  
先引入一个函数**mex{}**：  
定义**mex**函数的值为不属于集合**S**中的最小非负整数。  
即有**mex(S) = min{x} , x >= 0且x不属于S**  
例如，**mex({0, 2, 4}) = 1，mex({1, 2}) = 0**，当然这也包括空集，**mex({}) = 0**  
然后定义SG函数：  
![image](https://user-images.githubusercontent.com/74122331/153757778-66bc1f63-6445-473c-a0d2-31b586acb391.png)  

定理：SG函数等于0的状态是必败点，否则必胜。  
证明：联系上面关于必胜状态的三个定理：  
1.没有后继状态的状态是必败状态。没有后继状态时，SG函数等于mex一个空集，等于0.  
2.一个状态是必胜状态当且仅当存在至少一个必败状态为它的后继状态。如果有一个必败状态为它的后继，那么mex函数的参数（集合）中必定有一个等于0的元素，所以mex的结果大于0，即必胜状态的SG > 1.  
3.一个状态是必败状态当且仅当它的所有后继状态均为必胜状态。如果它的后继状态全是必胜状态，那么mex函数的参数（集合）中的所有元素全部大于0，则mex的结果等于0.  

SG定理的描述如下：  
![image](https://user-images.githubusercontent.com/74122331/153759367-d7b8831a-4330-4400-88e7-c0d7bad32ab6.png)
